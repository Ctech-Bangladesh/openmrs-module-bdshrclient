<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <changeSet id="shrclient-020514" author="tw" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from scheduler_task_config where
                schedulable_class='org.openmrs.module.shrclient.scheduler.tasks.BahmniSyncTask';
            </sqlCheck>
        </preConditions>

        <insert tableName="scheduler_task_config">
            <column name="name" value="Bahmni sync task"/>
            <column name="schedulable_class" value="org.bahmni.module.shrclient.scheduler.tasks.BahmniSyncTask"/>
            <column name="start_time" valueDate=" now() "/>
            <column name="start_time_pattern" value="MM/dd/yyyy HH:mm:ss"/>
            <column name="repeat_interval" value="60"/>
            <column name="start_on_startup" value="1"/>
            <column name="started" value="1"/>
            <column name="created_by" value="1"/>
            <column name="date_created" valueDate=" now() "/>
            <column name="uuid" valueComputed=" uuid() "/>
        </insert>

    </changeSet>

    <changeSet id="shrclient-040614" author="tw" context="setup">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                select count(*) from users where system_id = 'shrclientsystem';
            </sqlCheck>
        </preConditions>
        <sql>
            set @puuid = uuid();

            insert into person(birthdate_estimated, dead, creator, date_created, uuid)
            values(0, 0, 1, now(), @puuid);

            insert into users(system_id, creator, date_created, person_id, uuid, username)
            values ('shrclientsystem', 1, now(),(select person_id from person where uuid = @puuid) , uuid(), 'shrclientsystem');

            insert into provider (person_id, identifier, creator, date_created, uuid, name) values ((select person_id from person where uuid = @puuid), 'SHRCLIENTSYSTEM', 1, now(), uuid(), 'shrclientsystem');
        </sql>
    </changeSet>
</databaseChangeLog>
